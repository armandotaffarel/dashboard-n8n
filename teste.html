<html>
  <head>
    <meta charset="utf-8" />
    <title>Dashboard de Vendas</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
    </style>
  </head>

  <body class="relative min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-slate-100 p-6">

    <div class="absolute inset-0 overflow-hidden -z-10">
      <div class="absolute -left-24 -top-32 w-80 h-80 bg-blue-500/20 blur-3xl"></div>
      <div class="absolute right-0 top-10 w-96 h-96 bg-indigo-400/10 blur-3xl"></div>
      <div class="absolute left-20 bottom-0 w-72 h-72 bg-cyan-400/10 blur-3xl"></div>
    </div>

    <div class="max-w-5xl mx-auto bg-white/10 border border-white/10 backdrop-blur-xl p-8 rounded-2xl shadow-2xl shadow-blue-900/40">
      <div class="flex items-start justify-between gap-3 mb-6">
        <div>
          <p class="text-xs tracking-[0.3em] uppercase text-slate-400">Relatório</p>
          <h1 class="text-3xl font-bold text-white">Dashboard de Vendas</h1>
          <p class="text-sm text-slate-400 mt-1">Evolução mensal e totais consolidados</p>
        </div>
        <span class="px-3 py-1 rounded-full bg-emerald-500/15 text-emerald-200 text-xs border border-emerald-400/30">
          Atualiza a cada 30s
        </span>
      </div>

      <div class="mb-8 bg-white/5 border border-white/10 rounded-xl p-4 shadow-inner shadow-black/20">
        <canvas id="graficoVendas" class="w-full h-72"></canvas>
      </div>

      <div class="grid grid-cols-2 gap-4 mt-8">
        <div class="bg-white/10 border border-white/10 p-5 rounded-xl shadow-lg shadow-blue-900/20">
          <p class="text-sm text-slate-300">Vendas Totais no Ano</p>
          <p id="totalAno" class="text-3xl font-bold text-white mt-2"></p>
        </div>

        <div class="bg-white/10 border border-white/10 p-5 rounded-xl shadow-lg shadow-emerald-900/20">
          <p class="text-sm text-slate-300">Média Mensal</p>
          <p id="mediaMes" class="text-3xl font-bold text-emerald-200 mt-2"></p>
        </div>
      </div>
    </div>

    <script>
      const MESES = {{MESES}};
      const VALORES = {{VALORES}};

      // Plugin para exibir o valor de cada ponto no gráfico
      const valueLabels = {
        id: 'valueLabels',
        afterDatasetsDraw(chart) {
          const { ctx } = chart;
          ctx.save();

          chart.data.datasets.forEach((dataset, dsIndex) => {
            const meta = chart.getDatasetMeta(dsIndex);
            meta.data.forEach((point, idx) => {
              ctx.fillStyle = '#E5E7EB';
              ctx.font = '12px sans-serif';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'bottom';

              const value = 'R$ ' + dataset.data[idx].toLocaleString('pt-BR');
              ctx.fillText(value, point.x, point.y - 6);
            });
          });

          ctx.restore();
        }
      };

      Chart.register(valueLabels);

      const canvas = document.getElementById('graficoVendas');
      const gradient = canvas.getContext('2d').createLinearGradient(0, 0, 0, 350);
      gradient.addColorStop(0, 'rgba(59, 130, 246, 0.45)');
      gradient.addColorStop(1, 'rgba(59, 130, 246, 0.05)');

      new Chart(canvas, {
        type: 'line',
        data: {
          labels: MESES,
          datasets: [{
            label: 'Vendas (R$)',
            data: VALORES,
            borderWidth: 3,
            borderColor: 'rgba(59, 130, 246, 0.9)',
            backgroundColor: gradient,
            pointRadius: 5,
            pointHoverRadius: 7,
            pointBackgroundColor: 'rgba(59, 130, 246, 0.95)',
            fill: true,
            tension: 0.35
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: false,
              ticks: { color: '#E5E7EB' },
              grid: { color: 'rgba(255,255,255,0.06)' }
            },
            x: {
              ticks: { color: '#E5E7EB' },
              grid: { color: 'rgba(255,255,255,0.03)' }
            }
          },
          plugins: {
            legend: {
              labels: { color: '#E5E7EB', boxWidth: 12, boxHeight: 12 }
            },
            tooltip: {
              callbacks: {
                label: (ctx) => 'R$ ' + ctx.parsed.y.toLocaleString('pt-BR')
              }
            }
          }
        }
      });

      document.getElementById("totalAno").innerText =
        "R$ " + VALORES.reduce((a,b) => a + b, 0).toLocaleString("pt-BR");

      document.getElementById("mediaMes").innerText =
        "R$ " + (VALORES.reduce((a,b) => a + b, 0) / VALORES.length).toLocaleString("pt-BR");

      // Recarrega a página automaticamente a cada 30 segundos
      setInterval(() => {
        window.location.reload();
      }, 30000);
    </script>

  </body>
</html>
